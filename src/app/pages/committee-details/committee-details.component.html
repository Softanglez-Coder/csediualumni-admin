<div class="min-h-screen bg-gray-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Back Button -->
    <button
      routerLink="/committees"
      class="mb-6 px-4 py-2 bg-white text-gray-700 rounded-xl hover:bg-gray-50 transition-all border border-gray-200"
    >
      <i class="fas fa-arrow-left mr-2"></i>
      Back to Committees
    </button>

    <!-- Loading State -->
    @if (loading()) {
    <div class="text-center py-12">
      <div
        class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-purple-500 border-t-transparent"
      ></div>
      <p class="mt-4 text-gray-600">Loading committee details...</p>
    </div>
    }

    <!-- Committee Details -->
    @if (!loading() && committee(); as committee) {
    <!-- Header -->
    <div class="bg-white rounded-2xl p-8 shadow-lg mb-8">
      <div class="flex items-start justify-between">
        <div>
          <div class="flex items-center gap-3 mb-2">
            <h1 class="text-3xl font-bold text-gray-900">{{ committee.name }}</h1>
            @if (committee.isCurrent) {
            <span class="px-3 py-1 bg-green-100 text-green-700 text-sm font-semibold rounded-full">
              Current Committee
            </span>
            }
          </div>
          <p class="text-xl text-purple-600 font-semibold mb-2">{{ committee.year }}</p>
          @if (committee.description) {
          <p class="text-gray-600">
            {{ committee.description }}
          </p>
          }
        </div>
        <div class="flex gap-3">
          <button
            (click)="onShowEditModal()"
            class="px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-all"
          >
            <i class="fas fa-edit mr-2"></i>
            Edit
          </button>
        </div>
      </div>

      <div class="flex gap-6 mt-6 pt-6 border-t border-gray-100">
        <div class="text-center">
          <p class="text-3xl font-bold text-purple-600">
            {{ committee.designations.length }}
          </p>
          <p class="text-sm text-gray-600">Designations</p>
        </div>
        <div class="text-center">
          <p class="text-3xl font-bold text-pink-600">{{ committee.members.length }}</p>
          <p class="text-sm text-gray-600">Members</p>
        </div>
      </div>
    </div>

    <!-- Designations Section -->
    <div class="bg-white rounded-2xl p-8 shadow-lg mb-8">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Designations</h2>
        <button
          (click)="onShowDesignationModal()"
          class="px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-all"
        >
          <i class="fas fa-plus mr-2"></i>
          Add Designation
        </button>
      </div>

      @if (committee.designations.length === 0) {
      <div class="text-center py-8 text-gray-500">
        <i class="fas fa-user-tie text-4xl mb-2"></i>
        <p>No designations yet. Add one to get started.</p>
      </div>
      }

      <div class="grid md:grid-cols-2 gap-4">
        @for (designation of committee.designations; track designation._id) {
        <div class="border border-gray-200 rounded-xl p-4 hover:shadow-md transition-all">
          <div class="flex items-start justify-between mb-3">
            <div class="flex-1">
              <h3 class="text-lg font-bold text-gray-900">{{ designation.name }}</h3>
              <div class="flex flex-wrap gap-2 mt-2">
                @for (role of designation.roles; track role) {
                <span
                  class="px-2 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded-full"
                >
                  {{ getRoleLabel(role) }}
                </span>
                }
              </div>
            </div>
            <button
              (click)="onDeleteDesignation(designation)"
              class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-all"
              title="Delete"
            >
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <p class="text-sm text-gray-600">
            {{ getMemberCountForDesignation(designation._id) }} member(s)
          </p>
        </div>
        }
      </div>
    </div>

    <!-- Members Section -->
    <div class="bg-white rounded-2xl p-8 shadow-lg">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Members</h2>
        <button
          (click)="onShowMemberModal()"
          class="px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-all"
        >
          <i class="fas fa-plus mr-2"></i>
          Add Member
        </button>
      </div>

      @if (committee.members.length === 0) {
      <div class="text-center py-8 text-gray-500">
        <i class="fas fa-users text-4xl mb-2"></i>
        <p>No members yet. Add one to get started.</p>
      </div>
      }

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
        @for (member of populatedMembers(); track member.userId._id) {
        <div class="border border-gray-200 rounded-xl p-4 hover:shadow-md transition-all">
          <div class="flex items-start gap-3">
            @if (member.userId.avatar) {
            <img
              [src]="member.userId.avatar"
              [alt]="member.userId.firstName"
              class="w-12 h-12 rounded-full object-cover"
            />
            } @else {
            <div
              class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold"
            >
              {{ member.userId.firstName.charAt(0) }}{{ member.userId.lastName.charAt(0) }}
            </div>
            }
            <div class="flex-1">
              <h4 class="font-bold text-gray-900">
                {{ member.userId.firstName }} {{ member.userId.lastName }}
              </h4>
              <p class="text-sm text-purple-600 font-semibold">
                {{ getDesignationName(member.designationId) }}
              </p>
              <p class="text-xs text-gray-500">{{ member.userId.email }}</p>
            </div>
            <button
              (click)="onRemoveMember(member.userId._id)"
              class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-all"
              title="Remove"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
        }
      </div>
    </div>
    }
  </div>
</div>

<!-- Add Designation Modal -->
@if (showDesignationModal()) {
<div
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
  (click)="onCloseDesignationModal()"
>
  <div
    class="bg-white rounded-2xl p-8 max-w-lg w-full shadow-2xl"
    (click)="$event.stopPropagation()"
  >
    <h2 class="text-2xl font-bold text-gray-900 mb-6">Add Designation</h2>

    <form (ngSubmit)="onAddDesignation()" class="space-y-4">
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Designation Name</label>
        <input
          type="text"
          [(ngModel)]="newDesignationName"
          name="name"
          required
          class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent"
          placeholder="e.g., President, Vice President"
        />
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Roles</label>
        <div class="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-xl p-3">
          @for (role of availableRoles; track role.value) {
          <div class="flex items-center gap-2">
            <input
              type="checkbox"
              [id]="'role-' + role.value"
              [value]="role.value"
              (change)="onToggleRole(role.value, $event)"
              class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"
            />
            <label [for]="'role-' + role.value" class="text-sm text-gray-700">
              {{ role.label }}
            </label>
          </div>
          }
        </div>
      </div>

      <div class="flex gap-3 pt-4">
        <button
          type="button"
          (click)="onCloseDesignationModal()"
          class="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 transition-all"
        >
          Cancel
        </button>
        <button
          type="submit"
          [disabled]="saving()"
          class="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-semibold hover:shadow-xl transition-all disabled:opacity-50"
        >
          @if (!saving()) {
          <span>Add</span>
          } @else {
          <span>Adding...</span>
          }
        </button>
      </div>
    </form>
  </div>
</div>
}

<!-- Add Member Modal -->
@if (showMemberModal()) {
<div
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
  (click)="onCloseMemberModal()"
>
  <div
    class="bg-white rounded-2xl p-8 max-w-lg w-full shadow-2xl"
    (click)="$event.stopPropagation()"
  >
    <h2 class="text-2xl font-bold text-gray-900 mb-6">Add Member</h2>

    <form (ngSubmit)="onAddMember()" class="space-y-4">
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">User Email</label>
        <input
          type="email"
          [(ngModel)]="newMemberEmail"
          name="email"
          required
          class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent"
          placeholder="Enter user email address"
        />
        <p class="text-xs text-gray-500 mt-1">Enter the email of the user you want to add</p>
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Designation</label>
        <select
          [(ngModel)]="newMemberDesignationId"
          name="designationId"
          required
          class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent"
        >
          <option value="">Select a designation</option>
          @for (designation of committee()?.designations; track designation._id) {
          <option [value]="designation._id">
            {{ designation.name }}
          </option>
          }
        </select>
      </div>

      <div class="flex gap-3 pt-4">
        <button
          type="button"
          (click)="onCloseMemberModal()"
          class="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 transition-all"
        >
          Cancel
        </button>
        <button
          type="submit"
          [disabled]="saving()"
          class="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-semibold hover:shadow-xl transition-all disabled:opacity-50"
        >
          @if (!saving()) {
          <span>Add</span>
          } @else {
          <span>Adding...</span>
          }
        </button>
      </div>
    </form>
  </div>
</div>
}
